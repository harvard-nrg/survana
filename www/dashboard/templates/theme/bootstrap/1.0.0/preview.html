<!DOCTYPE html>
<html>
    <head>
        <title>Preview Questionnaire</title>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" type="text/css" href="assets/lib/survana/1.0.0/theme/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="assets/lib/survana/1.0.0/theme/bootstrap/css/bootstrap-theme.min.css">
        <link rel="stylesheet" type="text/css" href="assets/lib/survana/1.0.0/theme/bootstrap/css/matrix.css">
        <link rel="stylesheet" type="text/css" href="assets/lib/survana/1.0.0/theme/bootstrap/css/validation.css">
        <style type="text/css">
            question blockquote {
                color: #3a3a3a;
                border-left-color: #3a3a3a;
            }
        </style>
    </head>
    <body>
        <div id="content" class="container" style="margin-top:25px;"></div>

        <!-- form schemata -->
        <script id="schemata" type="text/schemata"></script>

        <!-- validation configuration -->
        <script id="validation" type="text/validation"></script>

        <!-- scripts must in the <body>, otherwise they cause the frame document to delay DOM parsing -->
        <script type="text/javascript" src="assets/lib/survana/1.0.0/theme/bootstrap/js/jquery.min.js"></script>
        <script type="text/javascript" src="assets/lib/survana/1.0.0/theme/bootstrap/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="assets/lib/survana/1.0.0/theme/bootstrap/js/validation.js"></script>

        <script type="text/javascript" src="assets/lib/survana/1.0.0/survana.js"></script>
        <script type="text/javascript" src="assets/lib/survana/1.0.0/survana-workflow.js"></script>
        <script type="text/javascript" src="assets/lib/survana/1.0.0/survana-validation.js"></script>

        <script type="text/javascript">
            function readSchemata(form) {
                console.log("reading schemata for", form);
                if (!form || !Survana) {
                    return;
                }

                var el = document.getElementById('schemata');

                if (!el || !el.innerHTML || !form.id) {
                    return;
                }

                console.log("trying to parse schemata");
                try {
                    Survana.Schema[form.id] = JSON.parse(el.innerHTML);
                    console.log('form', form.id, ' schemata', Survana.Schema[form.id]);
                } catch (e) {
                    console.error("Invalid Form Schemata:", el.innerHTML, e);
                }
            }

            //validation
            window.startValidation = function (form) {
                var validation_el = document.getElementById('validation'),
                        validation_config;

                if (!validation_el || !validation_el.innerHTML) {
                    return;
                }

                try {
                    validation_config = JSON.parse(validation_el.innerHTML);
                    console.log('validation config:', validation_el.innerHTML);
                } catch (e) {
                    console.error('Invalid Validation configuration:', validation_el.innerHTML, e);
                }

                //register validation configuration
                if (form && Survana !== undefined) {
                    Survana.Validation.SetConfiguration(form, validation_config);
                }
            };

            window.validateForm = function () {
                console.log("validateForm() called!");
                var form_id = document.forms[0].id;
                console.log("form_id = ", form_id);

                if (document.forms && document.forms[0] && Survana !== undefined) {
                    console.log("Survana.Schema[form_id]=", Survana.Schema[form_id]);
                    Survana.Validation.Validate(document.forms[0], Survana.Schema[form_id]);
                }
            };

            readSchemata(document.forms[0]);
            window.startValidation(document.forms[0]);
        </script>
    </body>
</html>
